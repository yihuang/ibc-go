"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[49796],{35680:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>l,frontMatter:()=>t,metadata:()=>r,toc:()=>d});var s=a(85893),c=a(11151);const t={title:"Incentivize packet",sidebar_label:"Incentivize packet",sidebar_position:6,slug:"/channel-upgrades/incentivize-packet"},i="Incentivize an ICS 20 transfer packet",r={id:"channel-upgrades/incentivize-packet",title:"Incentivize packet",description:"Register the counterparty payee",source:"@site/tutorials/02-channel-upgrades/06-incentivize-packet.md",sourceDirName:"02-channel-upgrades",slug:"/channel-upgrades/incentivize-packet",permalink:"/tutorials/channel-upgrades/incentivize-packet",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Incentivize packet",sidebar_label:"Incentivize packet",sidebar_position:6,slug:"/channel-upgrades/incentivize-packet"},sidebar:"defaultSidebar",previous:{title:"Upgrade channel",permalink:"/tutorials/channel-upgrades/upgrade-channel"}},o={},d=[{value:"Register the counterparty payee",id:"register-the-counterparty-payee",level:2},{value:"Multi-message transaction with single <code>MsgPayPacketFee</code> message",id:"multi-message-transaction-with-single-msgpaypacketfee-message",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,c.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"incentivize-an-ics-20-transfer-packet",children:"Incentivize an ICS 20 transfer packet"}),"\n",(0,s.jsx)(n.h2,{id:"register-the-counterparty-payee",children:"Register the counterparty payee"}),"\n",(0,s.jsxs)(n.p,{children:["All incentivization fees are paid to accounts on the chain from where the IBC packets originate. To ensure that the relayer that delivers the ",(0,s.jsx)(n.code,{children:"MsgRecvPacket"})," on the destination chain is correctly compensated, the counterparty payee address (i.e. the account address of the relayer on the source chain) needs to be registered on the destination chain. Throughout this tutorial the source chain is ",(0,s.jsx)(n.code,{children:"chain1"})," and the destination chain is ",(0,s.jsx)(n.code,{children:"chain2"}),", therefore we need to register the account address of the relayer on chain ",(0,s.jsx)(n.code,{children:"chain1"})," (",(0,s.jsx)(n.code,{children:"RLY_CHAIN1"}),") on chain ",(0,s.jsx)(n.code,{children:"chain2"})," (where the relayer has the account address ",(0,s.jsx)(n.code,{children:"RLY_CHAIN2"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"simd tx ibc-fee register-counterparty-payee transfer channel-0 $RLY_CHAIN2 $RLY_CHAIN1 \\\n--from $RLY_CHAIN2 \\\n--chain-id chain2 \\\n--keyring-backend test \\\n--home ../../gm/chain2 \\\n--node http://localhost:27010\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Once the above command succeeds, then we can verify which counterparty payee is registered on chain ",(0,s.jsx)(n.code,{children:"chain2"})," for account ",(0,s.jsx)(n.code,{children:"RLY_CHAIN2"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"simd q ibc-fee counterparty-payee channel-0 $RLY_CHAIN2 --node http://localhost:27010\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"counterparty_payee: cosmos1vdy5fp0jy2l2ees870a7mls357v7uad6ufzcyz\n"})}),"\n",(0,s.jsxs)(n.p,{children:["We see that the counterparty payee address matches what we expected (i.e. the ",(0,s.jsx)(n.code,{children:"RLY_CHAIN1"})," address). In this tutorial we are going to send only one packet from chain ",(0,s.jsx)(n.code,{children:"chain1"})," to chain ",(0,s.jsx)(n.code,{children:"chain2"}),", so we only need to register the counterparty payee on chain ",(0,s.jsx)(n.code,{children:"chain2"}),". In real life circumstances relayers relay packets on both directions (i.e. from chain ",(0,s.jsx)(n.code,{children:"chain1"})," to ",(0,s.jsx)(n.code,{children:"chain2"})," and also vice-versa), and thus relayers should register as well on chain ",(0,s.jsx)(n.code,{children:"chain1"})," the counterparty payee address to be compensated for delivering the ",(0,s.jsx)(n.code,{children:"MsgRecvPacket"})," on chain ",(0,s.jsx)(n.code,{children:"chain1"}),"."]}),"\n",(0,s.jsxs)(n.h2,{id:"multi-message-transaction-with-single-msgpaypacketfee-message",children:["Multi-message transaction with single ",(0,s.jsx)(n.code,{children:"MsgPayPacketFee"})," message"]}),"\n",(0,s.jsxs)(n.p,{children:["We first generate (not execute) an IBC transfer transaction (again ",(0,s.jsx)(n.code,{children:"1000samoleans"})," from ",(0,s.jsx)(n.code,{children:"VALIDATOR_CHAIN1"})," to ",(0,s.jsx)(n.code,{children:"VALIDATOR_CHAIN2"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"simd tx ibc-transfer transfer transfer channel-0 $VALIDATOR_CHAIN2 1000samoleans \\\n--from $VALIDATOR_CHAIN1 \\\n--chain-id chain1 \\\n--keyring-backend test \\\n--home ../../gm/chain1 \\\n--node tcp://localhost:27000 \\\n--generate-only > transfer.json\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then we prepend a ",(0,s.jsx)(n.code,{children:"MsgPayPacketFee"}),", sign the transaction and broadcast it. Please note that ",(0,s.jsx)(n.code,{children:"jq"})," is used to manipulate the transaction JSON file, making it a multi-message transaction. In practice, this multi-message transaction would be built using a gRPC or web client, for example, a web-based wallet application could fulfill this role. Note also that the ",(0,s.jsx)(n.code,{children:"signer"})," field uses the address of ",(0,s.jsx)(n.code,{children:"VALIDATOR_CHAIN1"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'jq \'.body.messages |= [{"@type":"/ibc.applications.fee.v1.MsgPayPacketFee","fee": {"recv_fee": [{"denom": "samoleans", "amount": "50"}], "ack_fee": [{"denom": "samoleans", "amount": "25"}], "timeout_fee": [{"denom": "samoleans", "amount": "10"}]}, "source_port_id": "transfer", "source_channel_id": "channel-0", "signer": "cosmos18phmkrpnn6gmpzscf6hnf5zpv06sygxc6f2v92" }] + .\' transfer.json > incentivized_transfer.json'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"simd tx sign incentivized_transfer.json \\\n--from $VALIDATOR_CHAIN1 \\\n--chain-id chain1 \\\n--keyring-backend test \\\n--home ../../gm/chain1 \\\n--node tcp://localhost:27000 > signed.json\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"simd tx broadcast signed.json \\\n--home ../../gm/chain1 \\\n--node tcp://localhost:27000\n"})}),"\n",(0,s.jsxs)(n.p,{children:["We wait for the relayer to relay the packet, and then we query the balance of account ",(0,s.jsx)(n.code,{children:"VALIDATOR_CHAIN2"})," on chain ",(0,s.jsx)(n.code,{children:"chain2"})," and see that it has indeed received an equivalent amount of vouchers for the ",(0,s.jsx)(n.code,{children:"1000samoleans"})," sent by ",(0,s.jsx)(n.code,{children:"VALIDATOR_CHAIN1"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"simd q bank balances $VALIDATOR_CHAIN2 --node http://localhost:27010\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'balances:\n- amount: "1000"\n  denom: ibc/27A6394C3F9FF9C9DCF5DFFADF9BB5FE9A37C7E92B006199894CF1824DF9AC7C\n- amount: "100000000"\n  denom: samoleans\n- amount: "99000000"\n  denom: stake\npagination:\n  total: "3"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["We check as well the balance for account ",(0,s.jsx)(n.code,{children:"VALIDATOR_CHAIN1"})," on chain ",(0,s.jsx)(n.code,{children:"chain1"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"simd q bank balances $WALLET_1 --node http://localhost:16657\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'./simd q bank balances $VALIDATOR_CHAIN1 --node http://localhost:27000\nbalances:\n- amount: "99998925"\n  denom: samoleans\n- amount: "99000000"\n  denom: stake\npagination:\n  total: "2"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["An amount of ",(0,s.jsx)(n.code,{children:"1075samoleans"})," has been deducted, which is what we expected: ",(0,s.jsx)(n.code,{children:"1000samoleans"})," have been transferred to ",(0,s.jsx)(n.code,{children:"VALIDATOR_CHAIN2"})," and ",(0,s.jsx)(n.code,{children:"75stake"})," have been paid for the receive and acknowledgment fees. The timeout fee has been refunded to ",(0,s.jsx)(n.code,{children:"VALIDATOR_CHAIN1"})," and the relayer address ",(0,s.jsx)(n.code,{children:"RLY_CHAIN1"})," should have gained ",(0,s.jsx)(n.code,{children:"75samoleans"})," for submitting the ",(0,s.jsx)(n.code,{children:"MsgRecvPacket"})," and the ",(0,s.jsx)(n.code,{children:"MsgAcknowledgement"})," messages."]})]})}function l(e={}){const{wrapper:n}={...(0,c.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},11151:(e,n,a)=>{a.d(n,{Z:()=>r,a:()=>i});var s=a(67294);const c={},t=s.createContext(c);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);